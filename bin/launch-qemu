#!/usr/bin/env bash
set -e

# pass env DEBUG=1 to print generated cmd;
#
# config (contains profiles definition) is put in QEMU_IMG_DIR;
#
# example:
#
# ```bash
# case "$1" in
#   profile-1)
#     args=(
#       qemu-system-x86_64
#       -nic user
#       -m 1g
#       -hda alpine.qcow2
#     )
#     ;;
#   profile-2)
#     args=(
#       qemu-system-x86_64
#       # with port forwarding
#       -nic user,hostfwd=tcp:127.0.0.1:2333-:22
#       -m 1g
#       -hda alpine.qcow2
#     )
#     ;;
# esac
# ```

cd ~/qemu
args=()
source ~/qemu/config

if [ "${#args[@]}" -eq 0 ]; then
    printf '%s\n\n%s\n' 'profile not found.' 'supported profiles:' >&2
    vm-list
    exit 1
fi

shift
if [ -n "$DEBUG" ]; then
    printf "%s %s\n" "${args[*]}" "$*"
else
    exec "${args[@]}" "$@"
fi
